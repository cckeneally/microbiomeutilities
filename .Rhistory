sample_data(ps0.gen)$group_var <- meta(ps0.gen)[,group]
grps <- unique(as.character(meta(ps0.gen)$group_var))
grps
prev <- prevalence(pm)
ls.pr <- NULL
for (g in grps){
pm <- subset_samples(ps0.gen, group_var == g)
prev <- prevalence(pm)
ls.pr[g] <- ls.pr
}
ls.pr
ls.pr <- NULL
for (g in grps){
pm <- subset_samples(ps0.gen, group_var == g)
prev <- prevalence(pm)
ls.pr[g] <- prev
}
ls.pr <- NULL
for (g in grps){
pm <- subset_samples(ps0.gen, group_var == g)
prev <- prevalence(pm)
ls.pr[[g] <- prev
}
}
beta_df <- compare_distances(ps,
dist.matrix=ps.dist,
method="mean",
group="DiseaseState",
na.rm=TRUE,
type="all")
ggplot(beta_df,
aes(comparison, mean.distance)) +
geom_boxplot()+ geom_point() +
theme_biome_utils() +
theme(axis.text.x = element_text(angle=90))
dist_between <- dist_melt %>%
left_join(ps.meta,
by = c("S2" = "Var2"),
suffix = c("_1", "_2")) %>%
filter(group_var_1 != group_var_2) %>%
mutate(comparison= paste0(group_var_1, " vs ", group_var_2)) %>%
group_by(S2, comparison) %>%
summarise(between.mean.dist=mean(value))
ggplot(dist_between,
aes(comparison, between.mean.dist)) +
geom_boxplot() + geom_point() +
theme(axis.text.x = element_text(angle=90))
head(dist_between)
table(dist_between$S2)
head(dist_between)
head(dist_within)
ls.pr <- NULL
for (g in grps){
pm <- subset_samples(ps0.gen, group_var == g)
prev <- prevalence(pm)
ls.pr[[g] <- prev
}
}
beta_df <- compare_distances(ps,
dist.matrix=ps.dist,
method="mean",
group="DiseaseState",
na.rm=TRUE,
type="all")
ggplot(beta_df,
aes(comparison, mean.distance)) +
geom_boxplot()+ geom_point() +
theme_biome_utils() +
theme(axis.text.x = element_text(angle=90))
dist_between <- dist_melt %>%
left_join(ps.meta,
by = c("S2" = "Var2"),
suffix = c("_1", "_2")) %>%
filter(group_var_1 != group_var_2) %>%
mutate(comparison= paste0(group_var_1, " vs ", group_var_2)) %>%
group_by(S2, comparison) %>%
summarise(between.mean.dist=mean(value))
ggplot(dist_between,
aes(comparison, between.mean.dist)) +
geom_boxplot() + geom_point() +
theme(axis.text.x = element_text(angle=90))
head(dist_between)
table(dist_between$S2)
head(dist_between)
head(dist_within)
ls.pr <- NULL
for (g in grps){
pm <- subset_samples(ps0.gen, group_var == g)
prev <- prevalence(pm)
ls.pr[[g]] <- prev
}
ls.pr
prev <- names(prev)==taxa
prev
prev <- names(prev)[taxa]
prev
taxa
names(prev)
prev <- prevalence(pm)
names(prev)[taxa]
names(prev)
names(prev)[taxa]
which(names(prev)==taxa)
prev <- prevalence(pm)
loc <- which(names(prev)==taxa)
prev[loc]
head(prev)
prev[5:30]
ls.pr <- NULL
for (g in grps){
pm <- subset_samples(ps0.gen, group_var == g)
prev <- prevalence(pm)
loc <- which(names(prev)==taxa)
ls.pr[[g]] <- prev[loc]
}
ls.pr
ls.pr <- NULL
for (g in grps){
pm <- subset_samples(ps0.gen, group_var == g)
prev <- prevalence(pm)
loc <- which(names(prev)=="g__Porphyromonas")
ls.pr[[g]] <- prev[loc]
}
ls.pr
ls.pr.d <- as.data.frame(ls.pr)
ls.pr.d
ls.pr.d <- t(as.data.frame(ls.pr))
ls.pr.d
colnames(ls.pr.d) <- "Prevalence"
ls.pr.d
ls.pr <- NULL
for (g in grps){
pm <- subset_samples(ps0.gen, group_var == g)
prev <- prevalence(pm)
loc <- which(names(prev)==taxa)
ls.pr[[g]] <- prev[loc]*100
}
ls.pr.d <- t(as.data.frame(ls.pr))
colnames(ls.pr.d) <- "Prevalence"
ls.pr.d
colnames(ls.pr.d) <- "Prevalence (%)"
ls.pr.d
bac_dom <- find_samples_taxa(ps0.gen, taxa = "g__Bacteroides")
bac_dom
bac_dom <- length(find_samples_taxa(ps0.gen, taxa = "g__Bacteroides"))
bac_dom
ls.pr <- NULL
for (g in grps){
pm <- subset_samples(ps0.gen, group_var == g)
prev <- prevalence(pm)
loc <- which(names(prev)==taxa)
ls.pr[[g]] <- prev[loc]*100
ndom[[g]] <- length(find_samples_taxa(pm, taxa = "g__Bacteroides"))
}
ls.pr <- NULL
ndom <- NULL
for (g in grps){
pm <- subset_samples(ps0.gen, group_var == g)
prev <- prevalence(pm)
loc <- which(names(prev)==taxa)
ls.pr[[g]] <- prev[loc]*100
ndom[[g]] <- length(find_samples_taxa(pm, taxa = "g__Bacteroides"))
}
ndom
colnames(ndom) <- "nsamples dominated"
ndom.d <- t(as.data.frame(ndom))
colnames(ndom.d) <- "nsamples dominated"
ndom.d
colnames(ndom.d) <- "Dominates"
ndom.d
ls.pr.d <- cbind(ls.pr.d, ndom.d)
ls.pr.d
get_gb
get_gb_s <- subset(get_gb, OTUID==taxa)
get_gb_s
ls.pr.d <- cbind(ls.pr.d, ndom.d,get_gb_s)
ls.pr.d
ls.pr.d <- cbind(ls.pr.d, ndom.d)
ls.pr.d
ls.pr.d <- t(as.data.frame(ls.pr))
colnames(ls.pr.d) <- "Prevalence (%)"
ndom.d <- t(as.data.frame(ndom))
colnames(ndom.d) <- "Dominates"
ls.pr.d <- cbind(ls.pr.d, ndom.d)
ls.pr.d
ls.pr.d <- cbind(ls.pr.d, ndom.d) %>% rownames_to_column("Group")
ls.pr.d <- t(as.data.frame(ls.pr))
colnames(ls.pr.d) <- "Prevalence (%)"
ndom.d <- t(as.data.frame(ndom))
colnames(ndom.d) <- "Dominates"
ls.pr.d <- cbind(ls.pr.d, ndom.d) %>% rownames_to_column("Group")
ls.pr.d <- t(as.data.frame(ls.pr))
colnames(ls.pr.d) <- "Prevalence (%)"
ndom.d <- t(as.data.frame(ndom))
colnames(ndom.d) <- "Dominates"
ls.pr.d <- cbind(ls.pr.d, ndom.d) %>%
as.data.frame() %>%
rownames_to_column("Group")
ls.pr.d
get_gb_s
ls.pr.d <- cbind(ls.pr.d, ndom.d) %>%
as.data.frame() %>%
rownames_to_column(group)
ls.pr.d <- t(as.data.frame(ls.pr))
colnames(ls.pr.d) <- "Prevalence (%)"
ndom.d <- t(as.data.frame(ndom))
colnames(ndom.d) <- "Dominates"
ls.pr.d <- cbind(ls.pr.d, ndom.d) %>%
as.data.frame() %>%
rownames_to_column(group)
get_gb_s <- subset(get_gb, OTUID==taxa) %>%
left_join(ls.pr.d)
get_gb_s
ggplot(get_gb_s, aes_string(group,mean_abundance)) +
geom_point(aes(size=sd_abundance))
ggplot(get_gb_s, aes_string(group,"mean_abundance")) +
geom_point(aes(size=sd_abundance))
ggplot(get_gb_s, aes_string(group,"mean_abundance")) +
geom_point(aes(size=sd_abundance), fill=NA)
ggplot(get_gb_s, aes_string(group,"mean_abundance")) +
geom_point(aes(size=sd_abundance), color=NA)
ggplot(get_gb_s, aes_string(group,"mean_abundance")) +
geom_point(aes(size=sd_abundance), color="grey70")
ggplot(get_gb_s, aes_string(group,"mean_abundance")) +
geom_point(aes(size=sd_abundance), color="grey70") +
theme_biome_utils()
ggplot(get_gb_s, aes_string(group,"mean_abundance")) +
geom_point(size=2, color="grey70") +
theme_biome_utils()
ggplot(get_gb_s, aes_string(group,"mean_abundance")) +
geom_point(size=5, color="grey70") +
theme_biome_utils()
ggplot(get_gb_s, aes_string(group,"mean_abundance")) +
geom_point(size=5, color="grey70") +
theme_biome_utils() +
geom_errorbar(aes(ymin=mean_abundance-sd_abundance, ymax=mean_abundance+sd_abundance))
p <- plot_listed_taxa(x,select.taxa = taxa, group = group)
p <- plot_listed_taxa(ps0.gen,select.taxa = taxa, group = group)
p
mycols <- c("brown3", "steelblue","grey50")
p <- plot_listed_taxa(ps0.gen,select.taxa = taxa, group = group, group.colors = mycols)
p
p <- plot_listed_taxa(ps0.gen,select.taxa = taxa, group = group,
group.colors = mycols) + coord_flip()
p
p.pr <- ggplot(get_gb_s, aes_string(group, "Dominates")) + geom_col()
p.pr
p.pr <- ggplot(get_gb_s, aes_string("Dominates",group)) + geom_col()
p.pr
p.pr <- ggplot(get_gb_s, aes_string("Dominates",group)) +
geom_col() + theme_biome_utils()
library(patchwork)
p + p.pr
p.pr <- ggplot(get_gb_s, aes_string("Dominates",group)) +
geom_col() + theme_biome_utils() +
theme(axis.title.x = element_blank(),
axis.text.x = element_blank())
p + p.pr
p.pr <- ggplot(get_gb_s, aes_string("Dominates",group)) +
geom_col() + theme_biome_utils() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank())
p + p.pr
p <- plot_listed_taxa(ps0.gen,select.taxa = taxa, group = group,
group.colors = mycols) + coord_flip()+
theme(strip.background = element_blank())
p.pr <- ggplot(get_gb_s, aes_string("Dominates",group)) +
geom_col() + theme_biome_utils() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank())
p + p.pr
p.pr <- ggplot(get_gb_s, aes_string("Dominates",group)) +
geom_col(width = 0.5) + theme_biome_utils() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank())
p + p.pr
p <- plot_listed_taxa(ps0.gen,select.taxa = taxa, group = group,
group.colors = mycols) + coord_flip()+
theme(strip.background = element_blank())
p.pr <- ggplot(get_gb_s, aes_string("Dominates",group)) +
geom_col(width = 0.5) + theme_biome_utils() +
scale_fill_manual(values = mycols) +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank())
p + p.pr
p <- plot_listed_taxa(ps0.gen,select.taxa = taxa, group = group,
group.colors = mycols) + coord_flip()+
theme(strip.background = element_blank())
p.pr <- ggplot(get_gb_s, aes_string("Dominates",group)) +
geom_col(width = 0.5, aes_string(fill=group)) + theme_biome_utils() +
scale_fill_manual(values = mycols) +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank())
p + p.pr
p + p.pr + plot_layout(widths = c(2,1))
p <- plot_listed_taxa(ps0.gen,select.taxa = taxa, group = group,
group.colors = mycols) + coord_flip()+
theme(strip.background = element_blank(),
strip.text = element_blank())
p.pr <- ggplot(get_gb_s, aes_string("Dominates",group)) +
geom_col(width = 0.5, aes_string(fill=group)) +
theme_biome_utils() +
scale_fill_manual(values = mycols) +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank())
p + p.pr + plot_layout(widths = c(2,1))
p <- plot_listed_taxa(ps0.gen,select.taxa = taxa, group = group,
group.colors = mycols) + coord_flip()+
theme(strip.background = element_blank())
p.pr <- ggplot(get_gb_s, aes_string("Dominates",group)) +
geom_col(width = 0.5, aes_string(fill=group)) +
theme_biome_utils() +
scale_fill_manual(values = mycols) +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank())
p + p.pr + plot_layout(widths = c(2,1))
get_gb_s
p.pr <- ggplot(get_gb_s, aes_string("`Prevalence (%)`",group)) +
geom_col(width = 0.5, aes_string(fill=group)) +
theme_biome_utils() +
scale_fill_manual(values = mycols) +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank())
p.pr
p <- plot_listed_taxa(ps0.gen,select.taxa = taxa, group = group,
group.colors = mycols) + coord_flip()+
theme(strip.background = element_blank())
p.dom <- ggplot(get_gb_s, aes_string("Dominates",group)) +
geom_col(width = 0.5, aes_string(fill=group)) +
theme_biome_utils() +
scale_fill_manual(values = mycols) +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank())
p.pr <- ggplot(get_gb_s, aes_string("`Prevalence (%)`",group)) +
geom_col(width = 0.5, aes_string(fill=group)) +
theme_biome_utils() +
scale_fill_manual(values = mycols) +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank())
p + p.dom + p.pr + plot_layout(widths = c(2,1,1))
p + p.dom + p.pr + plot_layout(widths = c(2,1,1), guides = "collect")
p.pr <- ggplot(get_gb_s, aes_string("`Prevalence (%)`",group)) +
geom_point(aes_string(fill=group)) +
theme_biome_utils() +
scale_fill_manual(values = mycols) +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank())
p + p.dom + p.pr + plot_layout(widths = c(2,1,1), guides = "collect")
p.pr <- ggplot(get_gb_s, aes_string("`Prevalence (%)`",group)) +
geom_point(aes_string(size= "`Prevalence (%)`",fill=group)) +
theme_biome_utils() +
scale_fill_manual(values = mycols) +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank())
p + p.dom + p.pr + plot_layout(widths = c(2,1,1), guides = "collect")
p.pr <- ggplot(get_gb_s, aes_string("`Prevalence (%)`",group)) +
geom_point(aes_string(size= "`Prevalence (%)`",color=group)) +
theme_biome_utils() +
scale_fill_manual(values = mycols) +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank())
p + p.dom + p.pr + plot_layout(widths = c(2,1,1), guides = "collect")
p + p.dom + p.pr + plot_layout(widths = c(2,1,1), guides = "collect")
p.pr <- ggplot(get_gb_s, aes_string("`Prevalence (%)`",group)) +
geom_col(width = 0.5, aes_string(fill=group)) +
theme_biome_utils() +
scale_fill_manual(values = mycols) +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank())
p + p.dom + p.pr + plot_layout(widths = c(2,1,1), guides = "collect")
roxygen2::roxygenize()
devtools::check()
pkgdown::build_site()
roxygen2::roxygenize()
devtools::check()
pkgdown::build_site()
roxygen2::roxygenize()
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(microbiome)
library(microbiomeutilities)
#library(gghalves)
library(tidyr)
data("hmp2")
ps <- hmp2
# pick visit 1 and 2
ps.sub <- subset_samples(ps, visit_number %in% c(1,2))
ps.sub <- prune_taxa(taxa_sums(ps.sub)>0, ps.sub)
ps.rel <- microbiome::transform(ps.sub, "compositional")
ps.rel.f <- format_to_besthit(ps.rel)
taxa_names(ps.rel.f)[1:50]
colnames(tax_table(ps.rel))
table(meta(ps.rel.f)$visit_number)
#table(meta(ps.rel.f)$visit_number, meta(ps.rel.f)$subject_id)
# there are two Participant_3 and Participant_11 with no time point2 sample
select.taxa <- c("444857:g__Fusobacterium", "580629:Bacteroides")
group.colors = c("brown3", "steelblue", "grey70")
p <- plot_paired_abundances (ps.rel.f,
select.taxa=select.taxa,
group="visit_number",
group.colors=group.colors,
dot.opacity = 0.25,
dot.size= 2,
add.violin = TRUE,
line = "subject_id",
line.down = "#7209b7",
line.stable = "red",
line.up = "#14213d",
line.na.value = "red",
line.guide = "none",
line.opacity = 0.25,
line.size = 1)
select.taxa <- c("444857:g__Fusobacterium", "851668:g__Prevotella")
group.colors = c("brown3", "steelblue", "grey70")
p <- plot_paired_abundances (ps.rel.f,
select.taxa=select.taxa,
group="visit_number",
group.colors=group.colors,
dot.opacity = 0.25,
dot.size= 2,
add.violin = TRUE,
line = "subject_id",
line.down = "#7209b7",
line.stable = "red",
line.up = "#14213d",
line.na.value = "red",
line.guide = "none",
line.opacity = 0.25,
line.size = 1)
print(p + xlab("Time point") + ylab("Relative abundance"))
top_taxa(ps.rel.f, 5)
select.taxa <- c("4430843:g__Prevotella", "580629:g__Bacteroides")
group.colors = c("brown3", "steelblue", "grey70")
p <- plot_paired_abundances (ps.rel.f,
select.taxa=select.taxa,
group="visit_number",
group.colors=group.colors,
dot.opacity = 0.25,
dot.size= 2,
add.violin = TRUE,
line = "subject_id",
line.down = "#7209b7",
line.stable = "red",
line.up = "#14213d",
line.na.value = "red",
line.guide = "none",
line.opacity = 0.25,
line.size = 1)
print(p + xlab("Time point") + ylab("Relative abundance"))
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
data("zackular2014")
p0 <- zackular2014
p0.f <- format_to_besthit(p0)
top_taxa(ps.rel.f, 5)
p0.f <- format_to_besthit(p0, "OTU:")
top_taxa(ps.rel.f, 5)
p0.f <- format_to_besthit(p0, prefix = "OTU:")
top_taxa(p0.f, 5)
p0.f <- format_to_besthit(p0)
top_taxa(p0.f, 5)
select.taxa <- c("d__denovo3:g__Bacteroides", "d__denovo2:g__Bacteroides")
mycols <- c("brown3", "steelblue", "grey50")
p <- plot_listed_taxa(p0.f, select.taxa,
group= "DiseaseState",
group.order = c("H","CRC","nonCRC"),
group.colors = mycols,
add.violin = TRUE,
violin.opacity = 0.3,
dot.opacity = 0.25,
box.opacity = 0.25,
panel.arrange= "grid")
print(p + ylab("Relative abundance") + scale_y_continuous(labels = scales::percent))
p0 <- zackular2014
ps <- add_refseq(ps0,tag="ASV")
ps <- add_refseq(p0,tag="ASV")
tag=NULL
if(is.na(tag) | is.null(tag)){
print("true")
}
if(is.na(tag) || is.null(tag)){
print("true")
}
tag="AS"
if(is.na(tag) || is.null(tag)){
print("true")
}
if(is.na(tag) || is.null(tag)){
print("true")
} else{
print("false")
}
tag=NA
if(is.na(tag) || is.null(tag)){
print("true")
} else{
print("false")
}
devtools::check()
